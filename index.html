<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „êµ­ ì£¼ìš” í–‰ì‚¬ ì§€ë„ (ë‹¤í¬ëª¨ë“œ + í•„í„°ë§)</title>
    
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', // ë‹¤í¬ëª¨ë“œ í™œì„±í™”
            theme: {
                extend: {
                    colors: {
                        'primary-500': '#10b981', // Emerald 500
                        'primary-600': '#059669', // Emerald 600
                    },
                    fontFamily: {
                        sans: ['Inter', 'Malgun Gothic', 'Dotum', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- Leaflet CSS ë¡œë“œ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    
    <style>
        /* ì§€ë„ ì „ì²´ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #map {
            height: 100vh;
            width: 100vw;
            z-index: 10;
        }

        /* Leaflet ë§ˆì»¤ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ ì˜¤ë²„ë¼ì´ë“œ */
        .event-marker {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #10b981;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .event-marker:hover {
            transform: scale(1.1);
        }
        
        .event-marker img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* í•˜ë‹¨ íƒ­ ìŠ¤íƒ€ì¼ */
        #detail-sheet {
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateY(100%);
            z-index: 50;
        }

        #detail-sheet.active {
            transform: translateY(0);
        }

        /* ìƒë‹¨ í•„í„° ë° ê²€ìƒ‰ íŒ¨ë„ */
        #control-panel {
            z-index: 40;
        }

        /* ë‹¤í¬ëª¨ë“œ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .dark ::-webkit-scrollbar {
            width: 8px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 overflow-hidden">

    <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ê²€ìƒ‰ + í•„í„°) -->
    <div id="control-panel" class="fixed top-0 left-0 right-0 bg-white dark:bg-gray-800 shadow-lg p-4 flex flex-col md:flex-row gap-3">
        
        <!-- ê²€ìƒ‰ì°½ -->
        <div class="flex-1">
            <input 
                type="text" 
                id="search-input" 
                placeholder="ì´ë²¤íŠ¸ëª… ë˜ëŠ” ì§€ì—­ìœ¼ë¡œ ê²€ìƒ‰..." 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
            />
        </div>

        <!-- ì§€ì—­ í•„í„° ë²„íŠ¼ -->
        <div class="flex gap-2 flex-wrap">
            <button class="filter-btn region-filter px-4 py-2 rounded-lg bg-primary-500 text-white font-semibold hover:bg-primary-600 transition" data-region="all">ì „ì²´</button>
            <button class="filter-btn region-filter px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition" data-region="ì¶©ë‚¨">ì¶©ë‚¨</button>
            <button class="filter-btn region-filter px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition" data-region="ì¶©ë¶">ì¶©ë¶</button>
        </div>

        <!-- í…Œë§ˆ í•„í„° ë²„íŠ¼ -->
        <div class="flex gap-2 flex-wrap">
            <button class="filter-btn theme-filter px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition" data-theme="ìŒì‹">ğŸ” ìŒì‹</button>
            <button class="filter-btn theme-filter px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition" data-theme="ë¬¸í™”">ğŸ­ ë¬¸í™”</button>
            <button class="filter-btn theme-filter px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition" data-theme="ìŒì•…">ğŸµ ìŒì•…</button>
        </div>

        <!-- ì»¤ìŠ¤í…€ ë¼ë²¨ ì¶”ê°€ ë²„íŠ¼ -->
        <button id="add-label-btn" class="px-4 py-2 rounded-lg bg-purple-500 text-white font-semibold hover:bg-purple-600 transition">
            â• ë¼ë²¨ ì¶”ê°€
        </button>
    </div>

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map" class="relative mt-20"></div>

    <!-- í•˜ë‹¨ ì´ë²¤íŠ¸ ìƒì„¸ ì •ë³´ íƒ­ (Bottom Sheet) -->
    <div id="detail-sheet" class="fixed bottom-0 left-0 right-0 max-h-[80vh] bg-white dark:bg-gray-800 rounded-t-3xl shadow-2xl p-6 md:p-8 flex flex-col">
        
        <!-- ë‹«ê¸° ë²„íŠ¼ ë° ì œëª© -->
        <div class="flex justify-between items-center mb-4 border-b border-gray-200 dark:border-gray-700 pb-3">
            <h2 id="sheet-title" class="text-2xl font-extrabold text-gray-900 dark:text-white"></h2>
            <button id="close-button" class="flex items-center space-x-1 px-4 py-2 bg-primary-500 hover:bg-primary-600 text-white font-semibold rounded-full shadow-lg transition duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-9V6a1 1 0 112 0v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3z" clip-rule="evenodd" />
                </svg>
                <span class="font-bold">ëŒì•„ê°€ê¸°</span>
            </button>
        </div>

        <!-- ìƒì„¸ ë‚´ìš© -->
        <div class="overflow-y-auto pb-4 flex-grow">
            <!-- ìš”ì•½ ì •ë³´ -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2 text-primary-600 dark:text-primary-400">í–‰ì‚¬ ìš”ì•½ ì •ë³´</h3>
                <p id="sheet-summary" class="text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-line text-lg"></p>
            </div>

            <!-- ì—°ì˜ˆì¸/ê²ŒìŠ¤íŠ¸ ì •ë³´ -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2 text-primary-600 dark:text-primary-400">ì°¸ê°€ ì—°ì˜ˆì¸/ê²ŒìŠ¤íŠ¸</h3>
                <p id="sheet-celeb" class="text-gray-700 dark:text-gray-300 leading-relaxed text-lg"></p>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ íƒœê·¸ -->
            <div>
                <h3 class="text-xl font-bold mb-2 text-primary-600 dark:text-primary-400">ì¹´í…Œê³ ë¦¬</h3>
                <div id="sheet-categories" class="flex gap-2 flex-wrap"></div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS ë¡œë“œ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    
    <!-- Leaflet MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <script>
        const apiKey = ""; 

        // 1. ê°€ìƒ ì´ë²¤íŠ¸ ë°ì´í„° (ì¹´í…Œê³ ë¦¬ ì¶”ê°€)
        const mockEvents = [
            // --- ì¶©ë‚¨ ì§€ì—­ ì´ë²¤íŠ¸ ---
            { 
                id: 1, name: "ì²œì•ˆ ë¹µ í˜ìŠ¤í‹°ë²Œ", lat: 36.814, lng: 127.113, 
                location: "ì²œì•ˆì‹œ ë™ë‚¨êµ¬", region: "ì¶©ë‚¨", category: "ìŒì‹",
                summary: "ì „êµ­ ìœ ëª… ë² ì´ì»¤ë¦¬ ì´ì§‘í•©! ë‹¤ì–‘í•œ ë¹µê³¼ ë””ì €íŠ¸ë¥¼ ì¦ê²¨ë³´ì„¸ìš”.\nê°€ì¡± ë‹¨ìœ„ ë°©ë¬¸ê°ì—ê²Œ ì¸ê¸°ê°€ ë§ìŠµë‹ˆë‹¤.\n(ê°€ìƒ ë°ì´í„°)", 
                celeb: "ìœ ëª… ì…°í”„ 'ê¹€ì œë¹µ', íŒŒí‹°ì‹œì— 'ì´ë‹¬ì½¤'", 
                imageUrl: "https://placehold.co/100x100/50bdae/ffffff?text=ë¹µì¶•ì œ",
                color: "#50bdae",
                customLabels: []
            },
            { 
                id: 2, name: "ë³´ë ¹ ë¨¸ë“œ ì¶•ì œ", lat: 36.315, lng: 126.541, 
                location: "ë³´ë ¹ì‹œ ëŒ€ì²œ í•´ìˆ˜ìš•ì¥", region: "ì¶©ë‚¨", category: "ìŒì•…",
                summary: "ì„¸ê³„ì ì¸ K-íŒ ìŠ¤íƒ€ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ì§œë¦¿í•œ ë¨¸ë“œ ì²´í—˜.\nì‹ ë‚˜ëŠ” ê³µì—°ê³¼ ì´ë²¤íŠ¸ê°€ ê°€ë“í•©ë‹ˆë‹¤.\nì—¬ë¦„ ëŒ€í‘œ ì¶•ì œ! (ê°€ìƒ ë°ì´í„°)", 
                celeb: "ì•„ì´ëŒ ê·¸ë£¹ 'ë¸”ë™ë¬¸', ê°€ìˆ˜ 'ì œì´í™‰' ì™¸ ë‹¤ìˆ˜", 
                imageUrl: "https://placehold.co/100x100/A0522D/ffffff?text=ë¨¸ë“œì¶•ì œ",
                color: "#A0522D",
                customLabels: []
            },
            { 
                id: 3, name: "ê³µì£¼ ë°±ì œ ë¬¸í™”ì œ", lat: 36.452, lng: 127.113, 
                location: "ê³µì£¼ì‹œ ê¸ˆê°• ì‹ ê´€ê³µì›", region: "ì¶©ë‚¨", category: "ë¬¸í™”",
                summary: "ì°¬ë€í–ˆë˜ ë°±ì œ ì™•ì¡°ì˜ ì—­ì‚¬ì™€ ë¬¸í™”ë¥¼ ì²´í—˜í•˜ëŠ” ëŒ€ê·œëª¨ ì¶•ì œ.\nì „í†µ ì˜ìƒ ì²´í—˜ ë° í¼ë ˆì´ë“œê°€ ì§„í–‰ë©ë‹ˆë‹¤.\n(ê°€ìƒ ë°ì´í„°)", 
                celeb: "ì—­ì‚¬ ê°•ì‚¬ 'ìµœì‚¬ì¸', êµ­ì•…ì¸ 'ì•ˆì†Œë¦¬'", 
                imageUrl: "https://placehold.co/100x100/7a0019/ffffff?text=ë°±ì œë¬¸í™”",
                color: "#7a0019",
                customLabels: []
            },
            { 
                id: 4, name: "ì•„ì‚° ì€í–‰ë‚˜ë¬´ê¸¸ ì¶•ì œ", lat: 36.786, lng: 127.009, 
                location: "ì•„ì‚°ì‹œ ì—¼ì¹˜ì ì€í–‰ë‚˜ë¬´ê¸¸", region: "ì¶©ë‚¨", category: "ë¬¸í™”",
                summary: "ê°€ì„ ë‹¨í’ìœ¼ë¡œ ë¬¼ë“  ì•„ë¦„ë‹¤ìš´ ì€í–‰ë‚˜ë¬´ê¸¸ì„ ê±·ëŠ” íë§ ì¶•ì œ.\nì§€ì—­ ì˜ˆìˆ ê°€ë“¤ì˜ ë²„ìŠ¤í‚¹ ê³µì—°ì´ í¼ì³ì§‘ë‹ˆë‹¤.\n(ê°€ìƒ ë°ì´í„°)", 
                celeb: "ì¸ë”” ë°´ë“œ 'ê°€ì„í•˜ëŠ˜', ì‹±ì–´ì†¡ë¼ì´í„° 'ë°•ê°ì„±'", 
                imageUrl: "https://placehold.co/100x100/FFD700/000000?text=ì€í–‰ì¶•ì œ",
                color: "#FFD700",
                customLabels: []
            },
            // --- ì¶©ë¶ ì§€ì—­ ì´ë²¤íŠ¸ ì¶”ê°€ ---
            { 
                id: 5, name: "ì²­ì£¼ ì§ì§€ ì½”ë¦¬ì•„", lat: 36.635, lng: 127.491, 
                location: "ì²­ì£¼ì‹œ ì²­ì£¼ ì˜ˆìˆ ì˜ì „ë‹¹", region: "ì¶©ë¶", category: "ë¬¸í™”",
                summary: "ì„¸ê³„ì—ì„œ ê°€ì¥ ì˜¤ë˜ëœ ê¸ˆì†í™œìë³¸ 'ì§ì§€'ë¥¼ ê¸°ë…í•˜ëŠ” êµ­ì œ ì¶•ì œ.\nì¸ì‡„ ë¬¸í™”ì™€ ì²¨ë‹¨ ê¸°ìˆ ì´ ìœµí•©ëœ ì „ì‹œê°€ ì—´ë¦½ë‹ˆë‹¤.\nìœ ë„¤ìŠ¤ì½” ì„¸ê³„ê¸°ë¡ìœ ì‚°! (ê°€ìƒ ë°ì´í„°)", 
                celeb: "ì—­ì‚¬í•™ì 'ë°•ê³ ì „', ë¯¸ìˆ  ì‘ê°€ 'í•œì§€í™”'", 
                imageUrl: "https://placehold.co/100x100/3498db/ffffff?text=ì§ì§€ì¶•ì œ",
                color: "#3498db",
                customLabels: []
            },
            { 
                id: 6, name: "ë‹¨ì–‘ ë§ˆëŠ˜ ì¶•ì œ", lat: 36.980, lng: 128.360, 
                location: "ë‹¨ì–‘êµ° ë‹¨ì–‘ì ë‚¨í•œê°•ë³€", region: "ì¶©ë¶", category: "ìŒì‹",
                summary: "ë‹¨ì–‘ íŠ¹ì‚°í’ˆì¸ ë§ˆëŠ˜ì„ ì£¼ì œë¡œ í•œ ê±´ê°• ì¶•ì œ.\në§ˆëŠ˜ ìš”ë¦¬ ê²½ì—°ëŒ€íšŒì™€ ê°ì¢… ì²´í—˜ í”„ë¡œê·¸ë¨ì´ í’ì„±í•©ë‹ˆë‹¤.\n(ê°€ìƒ ë°ì´í„°)", 
                celeb: "ë†ì—… ì „ë¬¸ê°€ 'ìµœë†ë¶€', í‘¸ë“œ ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ 'ì´ë§›ë‚˜'", 
                imageUrl: "https://placehold.co/100x100/8c7e00/ffffff?text=ë§ˆëŠ˜ì¶•ì œ",
                color: "#8c7e00",
                customLabels: []
            },
            { 
                id: 7, name: "ì œì²œ êµ­ì œ ìŒì•… ì˜í™”ì œ", lat: 37.130, lng: 128.205, 
                location: "ì œì²œì‹œ ì²­í’í˜¸ë°˜", region: "ì¶©ë¶", category: "ìŒì•…",
                summary: "ìŒì•…ì„ ë§¤ê°œë¡œ í•˜ëŠ” êµ­ë‚´ ìœ ì¼ì˜ ì˜í™”ì œ.\nì•„ë¦„ë‹¤ìš´ í˜¸ë°˜ì—ì„œ í¼ì³ì§€ëŠ” ì•¼ì™¸ ìƒì˜ê³¼ ê³µì—°ì´ ë°±ë¯¸ì…ë‹ˆë‹¤.\n(ê°€ìƒ ë°ì´í„°)", 
                celeb: "ì˜í™”ê°ë… 'ê¹€ì‹œë„¤', ì¬ì¦ˆ ë®¤ì§€ì…˜ 'íŠ¸ë¦¬ì˜¤ ë¸”ë£¨'", 
                imageUrl: "https://placehold.co/100x100/e74c3c/ffffff?text=ìŒì•…ì˜í™”",
                color: "#e74c3c",
                customLabels: []
            },
            { 
                id: 8, name: "ê´´ì‚° ê³ ì¶” ì¶•ì œ", lat: 36.816, lng: 127.817, 
                location: "ê´´ì‚°êµ° ê´´ì‚°ì ë™ì§„ì²œë³€", region: "ì¶©ë¶", category: "ìŒì‹",
                summary: "ê´´ì‚°ì˜ ëª…ë¬¼ì¸ ì²­ê²° ê³ ì¶”ë¥¼ í™ë³´í•˜ëŠ” ì§€ì—­ ì¶•ì œ.\nê³ ì¶” ë¨¹ê¸° ëŒ€íšŒ, ë¬¼ê³ ê¸° ì¡ê¸° ë“± ì¬ë¯¸ìˆëŠ” ì´ë²¤íŠ¸ê°€ ë§ìŠµë‹ˆë‹¤.\n(ê°€ìƒ ë°ì´í„°)", 
                celeb: "ê°œê·¸ë§¨ 'ìœ ì¬ë°Œ', íŠ¸ë¡œíŠ¸ ê°€ìˆ˜ 'ì†¡ê°€ì¸'", 
                imageUrl: "https://placehold.co/100x100/c0392b/ffffff?text=ê³ ì¶”ì¶•ì œ",
                color: "#c0392b",
                customLabels: []
            }
        ];

        let map;
        let detailSheet;
        let closeButton;
        let markerClusterGroup; // ë§ˆì»¤ í´ëŸ¬ìŠ¤í„° ê·¸ë£¹
        let allMarkers = []; // ëª¨ë“  ë§ˆì»¤ ì €ì¥
        let activeFilters = { region: 'all', theme: null, search: '' };

        // 2. ì§€ë„ ì´ˆê¸°í™” ë° ëŒ€í•œë¯¼êµ­ ì§€ì—­ ë„ìš°ê¸°
        function initializeMap() {
            detailSheet = document.getElementById('detail-sheet');
            closeButton = document.getElementById('close-button');

            if (typeof L === 'undefined' || !L.map) {
                 console.error("Leaflet is still not loaded properly. Cannot initialize map.");
                 return; 
            }

            const koreaCenter = [35.9, 127.5]; 
            const initialZoom = 7;

            map = L.map('map').setView(koreaCenter, initialZoom);
            
            map.on('tileloadstart', function() {
                console.log('Map tile loading started.');
            });
            map.on('load', function() {
                console.log('Map loaded successfully.');
            });

            // ë‹¤í¬ëª¨ë“œ íƒ€ì¼ ë ˆì´ì–´ (ì–´ë‘ìš´ í…Œë§ˆ)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
            }).addTo(map);

            // ë§ˆì»¤ í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ ì´ˆê¸°í™”
            markerClusterGroup = L.markerClusterGroup({
                maxClusterRadius: 60,
                spiderfyOnMaxZoom: true,
                showCoverageOnHover: false
            });
            map.addLayer(markerClusterGroup);

            loadEventMarkers();
            
            if (closeButton) {
                closeButton.addEventListener('click', hideDetailSheet);
            }

            // í•„í„° ë° ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            setupFilterListeners();
        }

        // 3. ì´ë²¤íŠ¸ ë§ˆì»¤ í‘œì‹œ
        function loadEventMarkers(filteredEvents = mockEvents) {
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            markerClusterGroup.clearLayers();
            allMarkers = [];

            filteredEvents.forEach(event => {
                const customIcon = L.divIcon({
                    className: 'custom-event-marker',
                    html: `
                        <div class="event-marker" style="border-color: ${event.color};">
                            <img src="${event.imageUrl}" alt="${event.name} ëŒ€í‘œ ì´ë¯¸ì§€" 
                                onerror="this.onerror=null; this.src='https://placehold.co/100x100/${event.color.substring(1)}/ffffff?text=Event';" />
                        </div>
                    `,
                    iconSize: [64, 64],
                    iconAnchor: [32, 64]
                });

                const marker = L.marker([event.lat, event.lng], { icon: customIcon })
                    .bindTooltip(event.name, { 
                        permanent: true, 
                        direction: 'top',
                        offset: [0, -70],
                        className: 'bg-primary-500 text-white px-2 py-1 rounded-full shadow font-semibold whitespace-nowrap'
                    });

                marker.on('click', () => {
                    showDetailSheet(event);
                });

                // í´ëŸ¬ìŠ¤í„° ê·¸ë£¹ì— ì¶”ê°€
                markerClusterGroup.addLayer(marker);
                allMarkers.push({ marker, event });
            });
        }

        // 4. í•„í„° ë° ê²€ìƒ‰ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupFilterListeners() {
            // ì§€ì—­ í•„í„°
            document.querySelectorAll('.region-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                    // í™œì„± ìƒíƒœ í† ê¸€
                    document.querySelectorAll('.region-filter').forEach(b => {
                        b.classList.remove('bg-primary-500', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    });
                    this.classList.add('bg-primary-500', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');

                    activeFilters.region = this.dataset.region;
                    applyFilters();
                });
            });

            // í…Œë§ˆ í•„í„°
            document.querySelectorAll('.theme-filter').forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    
                    if (activeFilters.theme === theme) {
                        // ì´ë¯¸ í™œì„±í™”ëœ í…Œë§ˆ í´ë¦­ ì‹œ ë¹„í™œì„±í™”
                        activeFilters.theme = null;
                        this.classList.remove('bg-primary-500', 'text-white');
                        this.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                    } else {
                        // ë‹¤ë¥¸ í…Œë§ˆ í•„í„° ë¹„í™œì„±í™”
                        document.querySelectorAll('.theme-filter').forEach(b => {
                            b.classList.remove('bg-primary-500', 'text-white');
                            b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                        });
                        this.classList.add('bg-primary-500', 'text-white');
                        this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                        activeFilters.theme = theme;
                    }
                    
                    applyFilters();
                });
            });

            // ê²€ìƒ‰ ê¸°ëŠ¥
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', function() {
                activeFilters.search = this.value.toLowerCase();
                applyFilters();
            });

            // ì»¤ìŠ¤í…€ ë¼ë²¨ ì¶”ê°€ ë²„íŠ¼
            document.getElementById('add-label-btn').addEventListener('click', function() {
                const labelName = prompt('ì¶”ê°€í•  ë¼ë²¨ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
                if (labelName && labelName.trim()) {
                    alert(`"${labelName}" ë¼ë²¨ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! (í˜„ì¬ëŠ” ì‹œì—°ìš© ì•Œë¦¼ì…ë‹ˆë‹¤)`);
                    // ì‹¤ì œ êµ¬í˜„: ì„ íƒëœ ì´ë²¤íŠ¸ì— customLabels ë°°ì—´ì— ì¶”ê°€
                }
            });
        }

        // 5. í•„í„° ì ìš©
        function applyFilters() {
            let filtered = mockEvents;

            // ì§€ì—­ í•„í„°
            if (activeFilters.region !== 'all') {
                filtered = filtered.filter(e => e.region === activeFilters.region);
            }

            // í…Œë§ˆ í•„í„°
            if (activeFilters.theme) {
                filtered = filtered.filter(e => e.category === activeFilters.theme);
            }

            // ê²€ìƒ‰ í•„í„°
            if (activeFilters.search) {
                filtered = filtered.filter(e => 
                    e.name.toLowerCase().includes(activeFilters.search) ||
                    e.location.toLowerCase().includes(activeFilters.search)
                );
            }

            loadEventMarkers(filtered);
        }

        // 6. ìƒì„¸ ì •ë³´ íƒ­ í‘œì‹œ ë° ë‚´ìš© ì±„ìš°ê¸°
        function showDetailSheet(eventData) {
            if (!detailSheet) return;

            document.getElementById('sheet-title').textContent = eventData.name + ' (' + eventData.location + ')';
            document.getElementById('sheet-summary').textContent = eventData.summary;
            document.getElementById('sheet-celeb').textContent = eventData.celeb;

            // ì¹´í…Œê³ ë¦¬ íƒœê·¸ í‘œì‹œ
            const categoriesContainer = document.getElementById('sheet-categories');
            categoriesContainer.innerHTML = '';
            
            // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬
            const categoryBadge = document.createElement('span');
            categoryBadge.className = 'px-3 py-1 rounded-full text-sm font-semibold bg-primary-500 text-white';
            categoryBadge.textContent = eventData.category;
            categoriesContainer.appendChild(categoryBadge);

            // ì§€ì—­ ë±ƒì§€
            const regionBadge = document.createElement('span');
            regionBadge.className = 'px-3 py-1 rounded-full text-sm font-semibold bg-blue-500 text-white';
            regionBadge.textContent = eventData.region;
            categoriesContainer.appendChild(regionBadge);

            // ì»¤ìŠ¤í…€ ë¼ë²¨ í‘œì‹œ
            eventData.customLabels.forEach(label => {
                const labelBadge = document.createElement('span');
                labelBadge.className = 'px-3 py-1 rounded-full text-sm font-semibold bg-purple-500 text-white';
                labelBadge.textContent = label;
                categoriesContainer.appendChild(labelBadge);
            });

            detailSheet.classList.add('active');
            map.panTo([eventData.lat, eventData.lng]);
        }

        // 7. íƒ­ ë‹«ê¸° (ëŒì•„ê°€ê¸°) ê¸°ëŠ¥
        function hideDetailSheet() {
            if (detailSheet) {
                detailSheet.classList.remove('active');
            }
        }

        // ì´ˆê¸°í™”
        window.onload = initializeMap;
        
    </script>
</body>
</html>

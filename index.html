<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventMap Pro: Korea & Japan</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#121212',
                        'dark-surface': '#1E1E1E',
                        'primary-500': '#10b981',
                        'primary-glow': '#ffeb3b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'Malgun Gothic', 'Dotum', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <!-- Leaflet MarkerCluster CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <style>
        /* ë§µ ê°•ì œ ë‹¤í¬ëª¨ë“œ (Invert Filter) */
        .leaflet-tile-pane {
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }

        /* ë§µ ì „ì²´ ìŠ¤íƒ€ì¼ */
        #map {
            height: 100vh;
            width: 100vw;
            z-index: 10;
            background-color: #121212;
        }

        /* ì»¤ìŠ¤í…€ ë§ˆì»¤ ìŠ¤íƒ€ì¼ */
        .event-marker {
            width: 57.6px;  /* 10% ê°ì†Œ */
            height: 57.6px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #10b981;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            background: #1e1e1e;
        }
        .event-marker:hover {
            transform: scale(1.1);
            z-index: 1000 !important;
        }
        .event-marker img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ì„ íƒëœ ë§ˆì»¤ ìŠ¤íƒ€ì¼ (Alt+Drag) */
        .event-marker.selected-marker {
            border-color: #ff4444 !important;
            box-shadow: 0 0 15px #ff4444;
            transform: scale(1.15);
        }

        /* í´ëŸ¬ìŠ¤í„°ë§: ë°ì´í„° ë§ì„ ë•Œ ë¹¨ê°„ìƒ‰ í‘œì‹œ */
        .marker-cluster-small { background-color: rgba(181, 226, 140, 0.6); }
        .marker-cluster-small div { background-color: rgba(110, 204, 57, 0.6); }
        .marker-cluster-medium { background-color: rgba(241, 211, 87, 0.6); }
        .marker-cluster-medium div { background-color: rgba(240, 194, 12, 0.6); }
        
        .marker-cluster-large { 
            background-color: rgba(253, 156, 115, 0.6); 
        }
        .marker-cluster-large div { 
            background-color: rgba(241, 128, 23, 0.6); 
        }
        
        .cluster-high-density {
            background-color: rgba(255, 0, 0, 0.4) !important;
        }
        .cluster-high-density div {
            background-color: rgba(255, 0, 0, 0.7) !important;
            color: white;
            font-weight: bold;
        }

        /* í•˜ë‹¨ íƒ­ (30% ê°ì†Œ) */
        #detail-sheet {
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateY(100%);
            z-index: 50;
        }
        #detail-sheet.active {
            transform: translateY(0);
        }

        /* ì§€ì—­ ê²½ê³„ ë°œê´‘ íš¨ê³¼ - ê°œì„ ëœ Pulse ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse-glow {
            0%, 100% { 
                stroke-opacity: 0.9; 
                stroke-width: 4;
                filter: drop-shadow(0 0 12px #ffeb3b) drop-shadow(0 0 24px #ffeb3b);
            }
            50% { 
                stroke-opacity: 0.5; 
                stroke-width: 6;
                filter: drop-shadow(0 0 20px #ffeb3b) drop-shadow(0 0 40px #ffeb3b);
            }
        }
        
        .region-glow-boundary {
            stroke: #ffeb3b;
            stroke-width: 4;
            fill: #ffeb3b;
            fill-opacity: 0.08;
            animation: pulse-glow 2.5s ease-in-out infinite;
            pointer-events: none;
        }

        /* ë“œë˜ê·¸ ì„ íƒ ë°•ìŠ¤ */
        .selection-box {
            border: 2px dashed #ff4444;
            background-color: rgba(255, 68, 68, 0.2);
            position: absolute;
            z-index: 2000;
            pointer-events: none;
        }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1a1a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #666; }
    </style>
</head>
<body class="bg-[#121212] text-gray-200 overflow-hidden font-sans">

    <!-- ìƒë‹¨ UI ì»¨í…Œì´ë„ˆ -->
    <div class="fixed top-4 left-0 right-0 z-[60] px-4 flex flex-col items-center gap-3 pointer-events-none">
        
        <!-- 1. ê²€ìƒ‰ì°½ -->
        <div class="relative group w-full max-w-md pointer-events-auto">
            <input type="text" id="search-input" 
                placeholder="ì¶•ì œëª…, ì§€ì—­, íƒœê·¸ ê²€ìƒ‰ (Alt+ë“œë˜ê·¸ë¡œ ë‹¤ì¤‘ì„ íƒ)" 
                class="w-full pl-10 pr-4 py-2 rounded-full bg-dark-surface border border-gray-700 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 text-white shadow-lg transition-all duration-300"
                autocomplete="off">
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            
            <!-- ìµœê·¼ ê²€ìƒ‰ì–´ -->
            <div id="search-history" class="hidden absolute top-full left-0 right-0 mt-2 bg-dark-surface rounded-xl shadow-2xl border border-gray-700 overflow-hidden">
                <div class="px-4 py-2 text-xs text-gray-500 font-bold bg-[#1a1a1a]">ìµœê·¼ ê²€ìƒ‰ (ìµœëŒ€ 5ê°œ)</div>
                <ul id="history-list" class="text-sm max-h-40 overflow-y-auto custom-scrollbar"></ul>
            </div>
        </div>

        <!-- 2. êµ­ê°€/ì§€ì—­ í•„í„° (2ë‹¨ êµ¬ì¡°) -->
        <div class="pointer-events-auto flex flex-col items-center gap-2 bg-dark-surface/80 backdrop-blur-md p-3 rounded-2xl border border-gray-700 shadow-xl max-w-3xl">
            <!-- êµ­ê°€ íƒ­ -->
            <div class="flex space-x-2">
                <button onclick="setCountry('Korea')" id="btn-korea" class="px-4 py-1.5 rounded-full text-sm font-bold bg-primary-500 text-white transition shadow-lg">ğŸ‡°ğŸ‡· í•œêµ­</button>
                <button onclick="setCountry('Japan')" id="btn-japan" class="px-4 py-1.5 rounded-full text-sm font-bold bg-gray-700 text-gray-300 hover:bg-gray-600 transition">ğŸ‡¯ğŸ‡µ ì¼ë³¸</button>
            </div>
            <!-- ì§€ì—­ ëª©ë¡ -->
            <div id="region-list" class="flex flex-wrap justify-center gap-2 max-h-32 overflow-y-auto custom-scrollbar"></div>
        </div>

        <!-- 3. í…Œë§ˆ í•„í„° -->
        <div class="pointer-events-auto flex space-x-2">
            <button onclick="filterByTag('ì „ì²´')" class="px-3 py-1 rounded-lg bg-gray-700 text-xs hover:bg-gray-600 transition">ì „ì²´</button>
            <button onclick="filterByTag('ìŒì‹')" class="px-3 py-1 rounded-lg bg-orange-900 text-orange-200 text-xs hover:bg-orange-800 transition">ğŸ” ìŒì‹</button>
            <button onclick="filterByTag('ë¬¸í™”')" class="px-3 py-1 rounded-lg bg-purple-900 text-purple-200 text-xs hover:bg-purple-800 transition">ğŸ­ ë¬¸í™”</button>
            <button onclick="filterByTag('ìŒì•…')" class="px-3 py-1 rounded-lg bg-red-900 text-red-200 text-xs hover:bg-red-800 transition">ğŸµ ìŒì•…</button>
            <button onclick="filterByTag('ìì—°')" class="px-3 py-1 rounded-lg bg-green-900 text-green-200 text-xs hover:bg-green-800 transition">ğŸŒ¿ ìì—°</button>
        </div>
    </div>

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map" class="relative outline-none"></div>

    <!-- ë“œë˜ê·¸ ì„ íƒ ë°•ìŠ¤ -->
    <div id="selection-box" class="selection-box hidden"></div>

    <!-- í•˜ë‹¨ ì´ë²¤íŠ¸ ìƒì„¸ ì •ë³´ íƒ­ (35% ê°ì†Œ) -->
    <div id="detail-sheet" class="fixed bottom-0 left-0 right-0 max-h-[35vh] bg-dark-surface rounded-t-3xl shadow-2xl p-4 md:p-5 flex flex-col border-t border-gray-700">
        
        <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ -->
        <div class="flex justify-between items-start mb-2 border-b border-gray-700 pb-2">
            <div class="flex-1 pr-4">
                <h2 id="sheet-title" class="text-lg font-extrabold text-white"></h2>
                <div id="sheet-tags" class="flex gap-1 mt-1 flex-wrap"></div>
            </div>
            <button id="close-button" class="flex-shrink-0 bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-full transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>

        <!-- ìƒì„¸ ë‚´ìš© -->
        <div class="overflow-y-auto flex-grow custom-scrollbar flex gap-3">
            <!-- ì´ë¯¸ì§€ (ë¹„ìœ¨ ìœ ì§€) -->
            <div class="w-2/5 flex-shrink-0">
                <img id="sheet-image" src="" class="w-full h-24 object-cover rounded-lg border border-gray-600" alt="í–‰ì‚¬ ì´ë¯¸ì§€">
            </div>
            <!-- í…ìŠ¤íŠ¸ -->
            <div class="w-3/5">
                <div class="mb-3">
                    <h3 class="text-xs font-bold text-primary-500 mb-1">í–‰ì‚¬ ìš”ì•½</h3>
                    <p id="sheet-summary" class="text-gray-300 text-xs leading-relaxed whitespace-pre-line"></p>
                </div>
                <div>
                    <h3 class="text-xs font-bold text-primary-500 mb-1">ì´ˆì²­ ê²ŒìŠ¤íŠ¸</h3>
                    <p id="sheet-celeb" class="text-gray-300 text-xs"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ë°ì´í„° ì •ì˜ (ì „êµ­ 24ê°œ + ì¼ë³¸ 13ê°œ) ---
        const mockEvents = [
            // í•œêµ­ - ì„œìš¸/ê²½ê¸°
            { id: 1, name: "ì„œìš¸ ë¶ˆê½ƒì¶•ì œ", lat: 37.528, lng: 126.936, location: "ì„œìš¸ ì—¬ì˜ë„", country: "Korea", region: "ì„œìš¸", tags: ["ë¬¸í™”", "ì•¼ê²½"], color: "#FF4500", summary: "í•œê°•ì˜ ê°€ì„ë°¤ì„ ìˆ˜ë†“ëŠ” êµ­ë‚´ ìµœëŒ€ ë¶ˆê½ƒì‡¼", celeb: "ë¶ˆê½ƒ ë””ìì´ë„ˆ", imageUrl: "https://placehold.co/400x300/FF4500/fff?text=Seoul+Firework" },
            { id: 2, name: "ì—ë²„ëœë“œ íŠ¤ë¦½ ì¶•ì œ", lat: 37.294, lng: 127.202, location: "ê²½ê¸° ìš©ì¸", country: "Korea", region: "ê²½ê¸°", tags: ["ìì—°"], color: "#FF69B4", summary: "ë´„ì˜ ì „ë ¹ì‚¬ íŠ¤ë¦½ 100ë§Œ ì†¡ì´", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FF69B4/fff?text=Tulip" },
            
            // ê°•ì›
            { id: 3, name: "í™”ì²œ ì‚°ì²œì–´ì¶•ì œ", lat: 38.106, lng: 127.709, location: "ê°•ì› í™”ì²œ", country: "Korea", region: "ê°•ì›", tags: ["ìì—°", "ê²¨ìš¸"], color: "#1E90FF", summary: "ì–¼ìŒ ìœ„ì—ì„œ ì¦ê¸°ëŠ” ì‚°ì²œì–´ ë‚šì‹œ", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/1E90FF/fff?text=IceFishing" },
            { id: 4, name: "ê°•ë¦‰ ì»¤í”¼ì¶•ì œ", lat: 37.773, lng: 128.948, location: "ê°•ì› ê°•ë¦‰", country: "Korea", region: "ê°•ì›", tags: ["ìŒì‹", "ë¬¸í™”"], color: "#6F4E37", summary: "ë°”ë‹¤ì™€ í•¨ê»˜í•˜ëŠ” ì»¤í”¼ ë¡œë“œ íƒë°©", celeb: "ë°”ë¦¬ìŠ¤íƒ€", imageUrl: "https://placehold.co/400x300/6F4E37/fff?text=Coffee" },
            { id: 5, name: "íƒœë°±ì‚° ëˆˆì¶•ì œ", lat: 37.164, lng: 128.986, location: "ê°•ì› íƒœë°±", country: "Korea", region: "ê°•ì›", tags: ["ìì—°", "ê²¨ìš¸"], color: "#E0FFFF", summary: "ëŒ€í˜• ëˆˆì¡°ê°ê³¼ ê²¨ìš¸ ì²´í—˜", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/E0FFFF/000?text=SnowFest" },
            
            // ì¶©ì²­
            { id: 6, name: "ë³´ë ¹ ë¨¸ë“œì¶•ì œ", lat: 36.315, lng: 126.541, location: "ì¶©ë‚¨ ë³´ë ¹", country: "Korea", region: "ì¶©ë‚¨", tags: ["ë¬¸í™”", "ì—¬ë¦„"], color: "#A0522D", summary: "ê¸€ë¡œë²Œ ë¨¸ë“œ ì²´í—˜ê³¼ K-POP", celeb: "K-POP ì•„ì´ëŒ", imageUrl: "https://placehold.co/400x300/A0522D/fff?text=Mud" },
            { id: 7, name: "ì²œì•ˆ ë¹µ í˜ìŠ¤í‹°ë²Œ", lat: 36.814, lng: 127.113, location: "ì¶©ë‚¨ ì²œì•ˆ", country: "Korea", region: "ì¶©ë‚¨", tags: ["ìŒì‹"], color: "#50bdae", summary: "ì „êµ­ ìœ ëª… ë¹µì§‘ ì§‘ê²°", celeb: "ê¹€ì œë¹µ", imageUrl: "https://placehold.co/400x300/50bdae/fff?text=Bread" },
            { id: 8, name: "ê³µì£¼ ë°±ì œë¬¸í™”ì œ", lat: 36.452, lng: 127.113, location: "ì¶©ë‚¨ ê³µì£¼", country: "Korea", region: "ì¶©ë‚¨", tags: ["ë¬¸í™”", "ì—­ì‚¬"], color: "#7a0019", summary: "ì°¬ë€í•œ ë°±ì œ ì™•ì¡°ì˜ ì—­ì‚¬ ì¬í˜„", celeb: "ì—­ì‚¬ ê°•ì‚¬", imageUrl: "https://placehold.co/400x300/7a0019/fff?text=Baekje" 

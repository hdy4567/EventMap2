<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventMap Pro: Korea & Japan</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#202124',
                        'dark-surface': '#292a2d',
                        'dark-card': '#35363a',
                        'primary-500': '#10b981',
                        'primary-glow': '#ffeb3b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'Malgun Gothic', 'Dotum', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <!-- Leaflet MarkerCluster CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <style>
        /* ë§µ ê°•ì œ ë‹¤í¬ëª¨ë“œ (Invert Filter) */
        .leaflet-tile-pane {
            filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }

        /* ë§µ ì „ì²´ ìŠ¤íƒ€ì¼ */
        #map {
            height: 100vh;
            width: 100vw;
            z-index: 10;
            background-color: #202124;
        }

        /* ì»¤ìŠ¤í…€ ë§ˆì»¤ ìŠ¤íƒ€ì¼ */
        .event-marker {
            width: 57.6px;  /* 10% ê°ì†Œ */
            height: 57.6px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #10b981;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            background: #1e1e1e;
        }
        .event-marker:hover {
            transform: scale(1.1);
            z-index: 1000 !important;
        }
        .event-marker img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ì„ íƒëœ ë§ˆì»¤ ìŠ¤íƒ€ì¼ (Alt+Drag) */
        .event-marker.selected-marker {
            border-color: #ff4444 !important;
            box-shadow: 0 0 15px #ff4444;
            transform: scale(1.15);
        }

        /* í´ëŸ¬ìŠ¤í„°ë§: ë°ì´í„° ë§ì„ ë•Œ ë¹¨ê°„ìƒ‰ í‘œì‹œ */
        .marker-cluster-small { background-color: rgba(181, 226, 140, 0.6); }
        .marker-cluster-small div { background-color: rgba(110, 204, 57, 0.6); }
        .marker-cluster-medium { background-color: rgba(241, 211, 87, 0.6); }
        .marker-cluster-medium div { background-color: rgba(240, 194, 12, 0.6); }
        
        .marker-cluster-large { 
            background-color: rgba(253, 156, 115, 0.6); 
        }
        .marker-cluster-large div { 
            background-color: rgba(241, 128, 23, 0.6); 
        }
        
        .cluster-high-density {
            background-color: rgba(255, 0, 0, 0.4) !important;
        }
        .cluster-high-density div {
            background-color: rgba(255, 0, 0, 0.7) !important;
            color: white;
            font-weight: bold;
        }

        /* í•˜ë‹¨ íƒ­ (30% ê°ì†Œ) */
        #detail-sheet {
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateY(100%);
            z-index: 50;
            background-color: #292a2d;
        }
        #detail-sheet.active {
            transform: translateY(0);
        }

        /* ì§€ì—­ ê²½ê³„ ë°œê´‘ íš¨ê³¼ - ê°œì„ ëœ Pulse ì• ë‹ˆë©”ì´ì…˜ (ë™ì  í¬ê¸° ëŒ€ì‘) */
        @keyframes pulse-glow {
            0%, 100% { 
                stroke-opacity: 0.9; 
                filter: drop-shadow(0 0 12px #ffeb3b) drop-shadow(0 0 24px #ffeb3b);
            }
            50% { 
                stroke-opacity: 0.5; 
                filter: drop-shadow(0 0 20px #ffeb3b) drop-shadow(0 0 40px #ffeb3b);
            }
        }
        
        .region-glow-boundary {
            stroke: #ffeb3b;
            stroke-width: 3;
            fill: #ffeb3b;
            fill-opacity: 0.08;
            animation: pulse-glow 2.5s ease-in-out infinite;
            pointer-events: none;
        }

        /* ë“œë˜ê·¸ ì„ íƒ ë°•ìŠ¤ */
        .selection-box {
            border: 2px dashed #ff4444;
            background-color: rgba(255, 68, 68, 0.2);
            position: absolute;
            z-index: 2000;
            pointer-events: none;
        }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1a1a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #666; }
    </style>
</head>
<body class="bg-[#202124] text-gray-200 overflow-hidden font-sans">

    <!-- ìƒë‹¨ UI ì»¨í…Œì´ë„ˆ -->
    <div class="fixed top-4 left-0 right-0 z-[60] px-4 flex flex-col items-center gap-3 pointer-events-none">
        
        <!-- 1. ê²€ìƒ‰ì°½ -->
        <div class="relative group w-full max-w-md pointer-events-auto">
            <input type="text" id="search-input" 
                placeholder="ì¶•ì œëª…, ì§€ì—­, íƒœê·¸ ê²€ìƒ‰ (Alt+ë“œë˜ê·¸ë¡œ ë‹¤ì¤‘ì„ íƒ)" 
                class="w-full pl-10 pr-4 py-2 rounded-full bg-[#292a2d] border border-gray-700 focus:border-primary-500 focus:ring-2 focus:ring-primary-500 text-white shadow-lg transition-all duration-300"
                autocomplete="off">
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            
            <!-- ìµœê·¼ ê²€ìƒ‰ì–´ -->
            <div id="search-history" class="hidden absolute top-full left-0 right-0 mt-2 bg-[#292a2d] rounded-xl shadow-2xl border border-gray-700 overflow-hidden">
                <div class="px-4 py-2 text-xs text-gray-400 font-bold bg-[#1a1a1a]">ìµœê·¼ ê²€ìƒ‰ (ìµœëŒ€ 5ê°œ)</div>
                <ul id="history-list" class="text-sm max-h-40 overflow-y-auto custom-scrollbar"></ul>
            </div>
        </div>

        <!-- 2. êµ­ê°€/ì§€ì—­ í•„í„° (2ë‹¨ êµ¬ì¡°) -->
        <div class="pointer-events-auto flex flex-col items-center gap-2 bg-[#292a2d]/95 backdrop-blur-md p-3 rounded-2xl border border-gray-700 shadow-xl max-w-3xl">
            <!-- êµ­ê°€ íƒ­ -->
            <div class="flex space-x-2">
                <button onclick="setCountry('Korea')" id="btn-korea" class="px-4 py-1.5 rounded-full text-sm font-bold bg-primary-500 text-white transition shadow-lg">ğŸ‡°ğŸ‡· í•œêµ­</button>
                <button onclick="setCountry('Japan')" id="btn-japan" class="px-4 py-1.5 rounded-full text-sm font-bold bg-gray-700 text-gray-300 hover:bg-gray-600 transition">ğŸ‡¯ğŸ‡µ ì¼ë³¸</button>
            </div>
            <!-- ì§€ì—­ ëª©ë¡ -->
            <div id="region-list" class="flex flex-wrap justify-center gap-2 max-h-32 overflow-y-auto custom-scrollbar"></div>
        </div>

        <!-- 3. í…Œë§ˆ í•„í„° -->
        <div class="pointer-events-auto flex space-x-2">
            <button onclick="filterByTag('ì „ì²´')" class="px-3 py-1 rounded-lg bg-gray-700 text-xs hover:bg-gray-600 transition text-white">ì „ì²´</button>
            <button onclick="filterByTag('ìŒì‹')" class="px-3 py-1 rounded-lg bg-orange-900 text-orange-200 text-xs hover:bg-orange-800 transition">ğŸ” ìŒì‹</button>
            <button onclick="filterByTag('ë¬¸í™”')" class="px-3 py-1 rounded-lg bg-purple-900 text-purple-200 text-xs hover:bg-purple-800 transition">ğŸ­ ë¬¸í™”</button>
            <button onclick="filterByTag('ìŒì•…')" class="px-3 py-1 rounded-lg bg-red-900 text-red-200 text-xs hover:bg-red-800 transition">ğŸµ ìŒì•…</button>
            <button onclick="filterByTag('ìì—°')" class="px-3 py-1 rounded-lg bg-green-900 text-green-200 text-xs hover:bg-green-800 transition">ğŸŒ¿ ìì—°</button>
        </div>
    </div>

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map" class="relative outline-none"></div>

    <!-- ë“œë˜ê·¸ ì„ íƒ ë°•ìŠ¤ -->
    <div id="selection-box" class="selection-box hidden"></div>

    <!-- í•˜ë‹¨ ì´ë²¤íŠ¸ ìƒì„¸ ì •ë³´ íƒ­ (35% ê°ì†Œ) -->
    <div id="detail-sheet" class="fixed bottom-0 left-0 right-0 max-h-[35vh] bg-[#292a2d] rounded-t-3xl shadow-2xl p-4 md:p-5 flex flex-col border-t border-gray-700">
        
        <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ -->
        <div class="flex justify-between items-start mb-2 border-b border-gray-700 pb-2">
            <div class="flex-1 pr-4">
                <h2 id="sheet-title" class="text-lg font-extrabold text-white"></h2>
                <div id="sheet-tags" class="flex gap-1 mt-1 flex-wrap"></div>
            </div>
            <button id="close-button" class="flex-shrink-0 bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-full transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>

        <!-- ìƒì„¸ ë‚´ìš© -->
        <div class="overflow-y-auto flex-grow custom-scrollbar flex gap-3">
            <!-- ì´ë¯¸ì§€ (ë¹„ìœ¨ ìœ ì§€) -->
            <div class="w-2/5 flex-shrink-0">
                <img id="sheet-image" src="" class="w-full h-24 object-cover rounded-lg border border-gray-600" alt="í–‰ì‚¬ ì´ë¯¸ì§€">
            </div>
            <!-- í…ìŠ¤íŠ¸ -->
            <div class="w-3/5">
                <div class="mb-3">
                    <h3 class="text-xs font-bold text-primary-500 mb-1">í–‰ì‚¬ ìš”ì•½</h3>
                    <p id="sheet-summary" class="text-gray-300 text-xs leading-relaxed whitespace-pre-line"></p>
                </div>
                <div>
                    <h3 class="text-xs font-bold text-primary-500 mb-1">ì´ˆì²­ ê²ŒìŠ¤íŠ¸</h3>
                    <p id="sheet-celeb" class="text-gray-300 text-xs"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ë°ì´í„° ì •ì˜ (ì „êµ­ í™•ì¥ + ì¼ë³¸ í™•ì¥) ---
        const mockEvents = [
            // í•œêµ­ - ì„œìš¸/ê²½ê¸°
            { id: 1, name: "ì„œìš¸ ë¶ˆê½ƒì¶•ì œ", lat: 37.528, lng: 126.936, location: "ì„œìš¸ ì—¬ì˜ë„", country: "Korea", region: "ì„œìš¸", tags: ["ë¬¸í™”", "ì•¼ê²½"], color: "#FF4500", summary: "í•œê°•ì˜ ê°€ì„ë°¤ì„ ìˆ˜ë†“ëŠ” êµ­ë‚´ ìµœëŒ€ ë¶ˆê½ƒì‡¼", celeb: "ë¶ˆê½ƒ ë””ìì´ë„ˆ", imageUrl: "https://placehold.co/400x300/FF4500/fff?text=Seoul+Firework" },
            { id: 2, name: "ì—ë²„ëœë“œ íŠ¤ë¦½ ì¶•ì œ", lat: 37.294, lng: 127.202, location: "ê²½ê¸° ìš©ì¸", country: "Korea", region: "ê²½ê¸°", tags: ["ìì—°"], color: "#FF69B4", summary: "ë´„ì˜ ì „ë ¹ì‚¬ íŠ¤ë¦½ 100ë§Œ ì†¡ì´", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FF69B4/fff?text=Tulip" },
            { id: 3, name: "ê´‘í™”ë¬¸ ê´‘ì¥ ì¶•ì œ", lat: 37.5759, lng: 126.9768, location: "ì„œìš¸ ì¢…ë¡œ", country: "Korea", region: "ì„œìš¸", tags: ["ë¬¸í™”", "ìŒì•…"], color: "#4169E1", summary: "ë„ì‹¬ ì† ë¬¸í™” ê³µì—°ê³¼ ê±°ë¦¬ ì˜ˆìˆ ", celeb: "K-POP ìŠ¤íƒ€", imageUrl: "https://placehold.co/400x300/4169E1/fff?text=Gwanghwamun" },
            
            // ê°•ì›
            { id: 4, name: "í™”ì²œ ì‚°ì²œì–´ì¶•ì œ", lat: 38.106, lng: 127.709, location: "ê°•ì› í™”ì²œ", country: "Korea", region: "ê°•ì›", tags: ["ìì—°", "ê²¨ìš¸"], color: "#1E90FF", summary: "ì–¼ìŒ ìœ„ì—ì„œ ì¦ê¸°ëŠ” ì‚°ì²œì–´ ë‚šì‹œ", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/1E90FF/fff?text=IceFishing" },
            { id: 5, name: "ê°•ë¦‰ ì»¤í”¼ì¶•ì œ", lat: 37.773, lng: 128.948, location: "ê°•ì› ê°•ë¦‰", country: "Korea", region: "ê°•ì›", tags: ["ìŒì‹", "ë¬¸í™”"], color: "#6F4E37", summary: "ë°”ë‹¤ì™€ í•¨ê»˜í•˜ëŠ” ì»¤í”¼ ë¡œë“œ íƒë°©", celeb: "ë°”ë¦¬ìŠ¤íƒ€", imageUrl: "https://placehold.co/400x300/6F4E37/fff?text=Coffee" },
            { id: 6, name: "íƒœë°±ì‚° ëˆˆì¶•ì œ", lat: 37.164, lng: 128.986, location: "ê°•ì› íƒœë°±", country: "Korea", region: "ê°•ì›", tags: ["ìì—°", "ê²¨ìš¸"], color: "#E0FFFF", summary: "ëŒ€í˜• ëˆˆì¡°ê°ê³¼ ê²¨ìš¸ ì²´í—˜", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/E0FFFF/000?text=SnowFest" },
            
            // ì¶©ì²­
            { id: 7, name: "ë³´ë ¹ ë¨¸ë“œì¶•ì œ", lat: 36.315, lng: 126.541, location: "ì¶©ë‚¨ ë³´ë ¹", country: "Korea", region: "ì¶©ë‚¨", tags: ["ë¬¸í™”", "ì—¬ë¦„"], color: "#A0522D", summary: "ê¸€ë¡œë²Œ ë¨¸ë“œ ì²´í—˜ê³¼ K-POP", celeb: "K-POP ì•„ì´ëŒ", imageUrl: "https://placehold.co/400x300/A0522D/fff?text=Mud" },
            { id: 8, name: "ì²œì•ˆ ë¹µ í˜ìŠ¤í‹°ë²Œ", lat: 36.814, lng: 127.113, location: "ì¶©ë‚¨ ì²œì•ˆ", country: "Korea", region: "ì¶©ë‚¨", tags: ["ìŒì‹"], color: "#50bdae", summary: "ì „êµ­ ìœ ëª… ë¹µì§‘ ì§‘ê²°", celeb: "ê¹€ì œë¹µ", imageUrl: "https://placehold.co/400x300/50bdae/fff?text=Bread" },
            { id: 9, name: "ê³µì£¼ ë°±ì œë¬¸í™”ì œ", lat: 36.452, lng: 127.113, location: "ì¶©ë‚¨ ê³µì£¼", country: "Korea", region: "ì¶©ë‚¨", tags: ["ë¬¸í™”", "ì—­ì‚¬"], color: "#7a0019", summary: "ì°¬ë€í•œ ë°±ì œ ì™•ì¡°ì˜ ì—­ì‚¬ ì¬í˜„", celeb: "ì—­ì‚¬ ê°•ì‚¬", imageUrl: "https://placehold.co/400x300/7a0019/fff?text=Baekje" },
            { id: 10, name: "ì²­ì£¼ ê³µì˜ˆë¹„ì—”ë‚ ë ˆ", lat: 36.642, lng: 127.489, location: "ì¶©ë¶ ì²­ì£¼", country: "Korea", region: "ì¶©ë¶", tags: ["ë¬¸í™”", "ì˜ˆìˆ "], color: "#8B4513", summary: "êµ­ì œ ê³µì˜ˆ ì‘í’ˆ ì „ì‹œ", celeb: "ê³µì˜ˆê°€", imageUrl: "https://placehold.co/400x300/8B4513/fff?text=Craft" },
            
            // ì „ë¼
            { id: 11, name: "ì „ì£¼ í•œì§€ë¬¸í™”ì¶•ì œ", lat: 35.824, lng: 127.147, location: "ì „ë¶ ì „ì£¼", country: "Korea", region: "ì „ë¶", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#DAA520", summary: "ì²œë…„ í•œì§€ì˜ ì•„ë¦„ë‹¤ì›€", celeb: "í•œì§€ ì¥ì¸", imageUrl: "https://placehold.co/400x300/DAA520/fff?text=Hanji" },
            { id: 12, name: "ê´‘ì£¼ ë¹„ì—”ë‚ ë ˆ", lat: 35.159, lng: 126.852, location: "ì „ë‚¨ ê´‘ì£¼", country: "Korea", region: "ì „ë‚¨", tags: ["ë¬¸í™”", "ì˜ˆìˆ "], color: "#9370DB", summary: "í˜„ëŒ€ë¯¸ìˆ ì˜ ì„¸ê³„ì  í–¥ì—°", celeb: "í˜„ëŒ€ë¯¸ìˆ ê°€", imageUrl: "https://placehold.co/400x300/9370DB/fff?text=Biennale" },
            { id: 13, name: "ì—¬ìˆ˜ ë°¤ë°”ë‹¤ ì¶•ì œ", lat: 34.760, lng: 127.662, location: "ì „ë‚¨ ì—¬ìˆ˜", country: "Korea", region: "ì „ë‚¨", tags: ["ìŒì•…", "ì•¼ê²½"], color: "#191970", summary: "ë°¤ë°”ë‹¤ì™€ í•¨ê»˜í•˜ëŠ” ìŒì•… ì¶•ì œ", celeb: "ì¸ë””ë°´ë“œ", imageUrl: "https://placehold.co/400x300/191970/fff?text=Yeosu" },
            { id: 14, name: "ë¬´ì£¼ ë°˜ë”§ë¶ˆì¶•ì œ", lat: 35.907, lng: 127.660, location: "ì „ë¶ ë¬´ì£¼", country: "Korea", region: "ì „ë¶", tags: ["ìì—°", "ì—¬ë¦„"], color: "#ADFF2F", summary: "ì²­ì • ìì—° ì† ë°˜ë”§ë¶ˆì´ êµ°ë¬´", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/ADFF2F/000?text=Firefly" },
            
            // ê²½ìƒ
            { id: 15, name: "ê²½ì£¼ ë²šê½ƒ ë§ˆë¼í†¤", lat: 35.856, lng: 129.224, location: "ê²½ë¶ ê²½ì£¼", country: "Korea", region: "ê²½ë¶", tags: ["ìì—°", "ìŠ¤í¬ì¸ "], color: "#FFC0CB", summary: "ê³ ë„ì˜ ë´„, ë²šê½ƒ ì•„ë˜ ë‹¬ë¦¬ê¸°", celeb: "ë§ˆë¼í† ë„ˆ", imageUrl: "https://placehold.co/400x300/FFC0CB/000?text=Cherry" },
            { id: 16, name: "ì•ˆë™ êµ­ì œíƒˆì¶¤í˜ìŠ¤í‹°ë²Œ", lat: 36.568, lng: 128.729, location: "ê²½ë¶ ì•ˆë™", country: "Korea", region: "ê²½ë¶", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#FF6347", summary: "ì„¸ê³„ íƒˆì¶¤ì˜ ì§‘ê²°ì§€", celeb: "íƒˆì¶¤ ëª…ì¸", imageUrl: "https://placehold.co/400x300/FF6347/fff?text=Mask" },
            { id: 17, name: "ì§„ì£¼ ë‚¨ê°• ìœ ë“±ì¶•ì œ", lat: 35.179, lng: 128.107, location: "ê²½ë‚¨ ì§„ì£¼", country: "Korea", region: "ê²½ë‚¨", tags: ["ë¬¸í™”", "ì•¼ê²½"], color: "#FFD700", summary: "ë‚¨ê°•ì„ ìˆ˜ë†“ëŠ” ì „í†µ ìœ ë“±", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FFD700/000?text=Lantern" },
            { id: 18, name: "í†µì˜ í•œì‚°ëŒ€ì²©ì¶•ì œ", lat: 34.854, lng: 128.433, location: "ê²½ë‚¨ í†µì˜", country: "Korea", region: "ê²½ë‚¨", tags: ["ë¬¸í™”", "ì—­ì‚¬"], color: "#4682B4", summary: "ì´ìˆœì‹  ì¥êµ°ì˜ í•´ì „ ì¬í˜„", celeb: "ì—­ì‚¬ í•´ì„¤ê°€", imageUrl: "https://placehold.co/400x300/4682B4/fff?text=Naval" },
            
            // ë¶€ì‚°/ì œì£¼
            { id: 19, name: "ë¶€ì‚° êµ­ì œì˜í™”ì œ", lat: 35.179, lng: 129.076, location: "ë¶€ì‚° í•´ìš´ëŒ€", country: "Korea", region: "ë¶€ì‚°", tags: ["ë¬¸í™”", "ì˜í™”"], color: "#DC143C", summary: "ì•„ì‹œì•„ ìµœëŒ€ ì˜í™”ì œ", celeb: "ì˜í™”ë°°ìš°", imageUrl: "https://placehold.co/400x300/DC143C/fff?text=BIFF" },
            { id: 20, name: "ë¶€ì‚° ë¶ˆê½ƒì¶•ì œ", lat: 35.153, lng: 129.118, location: "ë¶€ì‚° ê´‘ì•ˆë¦¬", country: "Korea", region: "ë¶€ì‚°", tags: ["ë¬¸í™”", "ì•¼ê²½"], color: "#FF1493", summary: "ê´‘ì•ˆëŒ€êµ ìœ„ ë¶ˆê½ƒì‡¼", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FF1493/fff?text=Firework" },
            { id: 21, name: "ì œì£¼ ë“¤ë¶ˆì¶•ì œ", lat: 33.455, lng: 126.560, location: "ì œì£¼ ì œì£¼ì‹œ", country: "Korea", region: "ì œì£¼", tags: ["ìì—°", "ì „í†µ"], color: "#FF4500", summary: "ìƒˆë´„ì„ ë§ì´í•˜ëŠ” ë“¤ë¶ˆë†€ì´", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FF4500/fff?text=Fire" },
            { id: 22, name: "ì œì£¼ ìœ ì±„ê½ƒ ì¶•ì œ", lat: 33.254, lng: 126.560, location: "ì œì£¼ ì„œê·€í¬", country: "Korea", region: "ì œì£¼", tags: ["ìì—°"], color: "#FFFF00", summary: "ë…¸ë€ ìœ ì±„ê½ƒ ë¬¼ê²°", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FFFF00/000?text=Canola" },

            // ì¼ë³¸ - ë„ì¿„
            { id: 101, name: "ì•„ì‚¬ì¿ ì‚¬ ì‚°ìë§ˆì¸ ë¦¬", lat: 35.714, lng: 139.796, location: "ë„ì¿„ ì•„ì‚¬ì¿ ì‚¬", country: "Japan", region: "ë„ì¿„", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#C71585", summary: "ì—ë„ ì‹œëŒ€ë¶€í„° ë‚´ë ¤ì˜¨ ëŒ€í˜• ë¯¸ì½”ì‹œ í–‰ë ¬", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/C71585/fff?text=Sanja" },
            { id: 102, name: "ìŠ¤ë¯¸ë‹¤ê°€ì™€ ë¶ˆê½ƒë†€ì´", lat: 35.709, lng: 139.801, location: "ë„ì¿„ ìŠ¤ë¯¸ë‹¤", country: "Japan", region: "ë„ì¿„", tags: ["ë¬¸í™”", "ì•¼ê²½"], color: "#FF69B4", summary: "ë„ì¿„ 3ëŒ€ ë¶ˆê½ƒë†€ì´, 20,000ë°œ ë°œì‚¬", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FF69B4/fff?text=Sumida" },
            { id: 103, name: "í•˜ë¼ì£¼ì¿  íŒ¨ì…˜ í˜ìŠ¤í‹°ë²Œ", lat: 35.670, lng: 139.702, location: "ë„ì¿„ ì‹œë¶€ì•¼", country: "Japan", region: "ë„ì¿„", tags: ["ë¬¸í™”", "ìŒì•…"], color: "#FF1493", summary: "ìŠ¤íŠ¸ë¦¬íŠ¸ íŒ¨ì…˜ê³¼ J-POP ë¼ì´ë¸Œ", celeb: "J-POP ì•„í‹°ìŠ¤íŠ¸", imageUrl: "https://placehold.co/400x300/FF1493/fff?text=Harajuku" },
            
            // ì˜¤ì‚¬ì¹´
            { id: 104, name: "í…ì§„ë§ˆì¸ ë¦¬", lat: 34.693, lng: 135.502, location: "ì˜¤ì‚¬ì¹´ í…ë§Œêµ¬", country: "Japan", region: "ì˜¤ì‚¬ì¹´", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#FFD700", summary: "ì¼ë³¸ 3ëŒ€ ë§ˆì¸ ë¦¬, 100ì²™ ë°° í–‰ë ¬", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FFD700/000?text=Tenjin" },
            { id: 105, name: "ë„í†¤ë³´ë¦¬ ìŒì‹ì¶•ì œ", lat: 34.668, lng: 135.501, location: "ì˜¤ì‚¬ì¹´ ë‚œë°”", country: "Japan", region: "ì˜¤ì‚¬ì¹´", tags: ["ìŒì‹"], color: "#FF6347", summary: "íƒ€ì½”ì•¼í‚¤, ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤ ì²œêµ­", celeb: "ìš”ë¦¬ì‚¬", imageUrl: "https://placehold.co/400x300/FF6347/fff?text=Dotonbori" },
            { id: 106, name: "ì˜¤ì‚¬ì¹´ì„± ë²šê½ƒ ì¶•ì œ", lat: 34.687, lng: 135.526, location: "ì˜¤ì‚¬ì¹´ ì£¼ì˜¤", country: "Japan", region: "ì˜¤ì‚¬ì¹´", tags: ["ìì—°", "ì—­ì‚¬"], color: "#FFC0CB", summary: "ì„±ê³½ê³¼ ë²šê½ƒì˜ ì¡°í™”", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FFC0CB/000?text=Osaka+Castle" },
            
            // êµí† 
            { id: 107, name: "ê¸°ì˜¨ë§ˆì¸ ë¦¬", lat: 35.003, lng: 135.768, location: "êµí†  ê¸°ì˜¨", country: "Japan", region: "êµí† ", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#DC143C", summary: "ì²œë…„ ì—­ì‚¬ì˜ ì•¼ë§ˆë³´ì½” ìˆœí–‰", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/DC143C/fff?text=Gion" },
            { id: 108, name: "ì•„ë¼ì‹œì•¼ë§ˆ ëŒ€ë‚˜ë¬´ìˆ² ì¶•ì œ", lat: 35.009, lng: 135.672, location: "êµí†  ì•„ë¼ì‹œì•¼ë§ˆ", country: "Japan", region: "êµí† ", tags: ["ìì—°", "ë¬¸í™”"], color: "#228B22", summary: "ì£½ë¦¼ ì† ë“±ë¶ˆ ì•¼ê²½", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/228B22/fff?text=Bamboo" },
            
            // í›„ì¿ ì˜¤ì¹´
            { id: 109, name: "í•˜ì¹´íƒ€ ê¸°ì˜¨ ì•¼ë§ˆì¹´ì‚¬", lat: 33.594, lng: 130.401, location: "í›„ì¿ ì˜¤ì¹´ í•˜ì¹´íƒ€", country: "Japan", region: "í›„ì¿ ì˜¤ì¹´", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#FF4500", summary: "ìƒˆë²½ 5ì‹œ ë‚¨ìë“¤ì˜ ì§ˆì£¼", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/FF4500/fff?text=Yamakasa" },
            { id: 110, name: "í›„ì¿ ì˜¤ì¹´ ë¼ë©´ í˜ìŠ¤í‹°ë²Œ", lat: 33.590, lng: 130.401, location: "í›„ì¿ ì˜¤ì¹´ í…ì§„", country: "Japan", region: "í›„ì¿ ì˜¤ì¹´", tags: ["ìŒì‹"], color: "#D2691E", summary: "í•˜ì¹´íƒ€ ëˆì½”ì¸  ë¼ë©´ ëŒ€íšŒ", celeb: "ë¼ë©˜ ì¥ì¸", imageUrl: "https://placehold.co/400x300/D2691E/fff?text=Ramen" },
            
            // í™‹ì¹´ì´ë„
            { id: 111, name: "ì‚¿í¬ë¡œ ëˆˆì¶•ì œ", lat: 43.064, lng: 141.347, location: "í™‹ì¹´ì´ë„ ì‚¿í¬ë¡œ", country: "Japan", region: "í™‹ì¹´ì´ë„", tags: ["ìì—°", "ê²¨ìš¸"], color: "#87CEEB", summary: "ëŒ€í˜• ëˆˆì¡°ê° ì˜ˆìˆ  ì „ì‹œ", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/87CEEB/000?text=Snow+Festival" },
            { id: 112, name: "í›„ë¼ë…¸ ë¼ë²¤ë” ì¶•ì œ", lat: 43.343, lng: 142.383, location: "í™‹ì¹´ì´ë„ í›„ë¼ë…¸", country: "Japan", region: "í™‹ì¹´ì´ë„", tags: ["ìì—°"], color: "#9370DB", summary: "ë³´ë¼ìƒ‰ ë¼ë²¤ë” ë“¤íŒ", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/9370DB/fff?text=Lavender" },
            
            // ì˜¤í‚¤ë‚˜ì™€
            { id: 113, name: "ë‚˜í•˜ ëŒ€ì¤„ë‹¤ë¦¬ê¸°", lat: 26.212, lng: 127.679, location: "ì˜¤í‚¤ë‚˜ì™€ ë‚˜í•˜", country: "Japan", region: "ì˜¤í‚¤ë‚˜ì™€", tags: ["ë¬¸í™”", "ì „í†µ"], color: "#00CED1", summary: "ê¸°ë„¤ìŠ¤ ì¸ì • ì„¸ê³„ ìµœëŒ€ ì¤„ë‹¤ë¦¬ê¸°", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/00CED1/fff?text=Naha" },
            { id: 114, name: "ì˜¤í‚¤ë‚˜ì™€ í•´ì–‘ ì—‘ìŠ¤í¬", lat: 26.694, lng: 127.878, location: "ì˜¤í‚¤ë‚˜ì™€ ëª¨í† ë¶€", country: "Japan", region: "ì˜¤í‚¤ë‚˜ì™€", tags: ["ìì—°", "ë¬¸í™”"], color: "#20B2AA", summary: "ì—ë©”ë„ë“œ í•´ë³€ê³¼ ë¥˜í ë¬¸í™”", celeb: "ì—†ìŒ", imageUrl: "https://placehold.co/400x300/20B2AA/fff?text=Ocean" },
        ];

        // --- 2. ì§€ì—­ ê²½ê³„ íŒŒë¼ë¯¸í„° (GeoJSON ì—†ì´ ë™ì‘) ---
        const regionBoundaryParams = {
            // í•œêµ­
            "ì„œìš¸": { bounds: [[37.42, 126.76], [37.70, 127.18]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ê²½ê¸°": { bounds: [[36.89, 126.70], [38.31, 127.52]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ê°•ì›": { bounds: [[37.02, 127.05], [38.61, 129.35]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì¶©ë‚¨": { bounds: [[35.98, 126.10], [37.00, 127.50]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì¶©ë¶": { bounds: [[36.30, 127.20], [37.20, 128.50]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì „ë¶": { bounds: [[35.40, 126.48], [36.20, 127.80]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì „ë‚¨": { bounds: [[34.20, 126.08], [35.50, 127.80]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ê²½ë¶": { bounds: [[35.60, 128.10], [37.20, 129.60]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ê²½ë‚¨": { bounds: [[34.60, 127.70], [35.90, 129.30]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ë¶€ì‚°": { bounds: [[35.05, 128.93], [35.25, 129.23]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì œì£¼": { bounds: [[33.19, 126.15], [33.57, 126.95]], glowColor: "#ffeb3b", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            
            // ì¼ë³¸
            "ë„ì¿„": { bounds: [[35.53, 139.56], [35.82, 139.93]], glowColor: "#ff69b4", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì˜¤ì‚¬ì¹´": { bounds: [[34.60, 135.41], [34.79, 135.60]], glowColor: "#ff69b4", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "êµí† ": { bounds: [[34.90, 135.60], [35.17, 135.88]], glowColor: "#ff69b4", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "í›„ì¿ ì˜¤ì¹´": { bounds: [[33.52, 130.30], [33.68, 130.52]], glowColor: "#ff69b4", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "í™‹ì¹´ì´ë„": { bounds: [[41.38, 139.70], [45.52, 145.82]], glowColor: "#ff69b4", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
            "ì˜¤í‚¤ë‚˜ì™€": { bounds: [[24.05, 122.93], [28.40, 131.35]], glowColor: "#ff69b4", strokeWidth: 3, duration: 2.5, opacity: 0.08 },
        };

        // --- 3. ì „ì—­ ë³€ìˆ˜ ---
        let map, markerClusterGroup;
        let allMarkers = [];
        let selectedMarkers = [];
        let currentRegionGlow = null;
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
        let currentCountry = 'Korea';

        // --- 4. ì§€ë„ ì´ˆê¸°í™” ---
        function initializeMap() {
            const detailSheet = document.getElementById('detail-sheet');
            const closeButton = document.getElementById('close-button');

            if (typeof L !== 'undefined') {
                map = L.map('map', {
                    center: [35.9, 127.5],
                    zoom: 7,
                    zoomControl: true,
                    attributionControl: false
                });

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                }).addTo(map);

                markerClusterGroup = L.markerClusterGroup({
                    maxClusterRadius: 80,
                    iconCreateFunction: function(cluster) {
                        const childCount = cluster.getChildCount();
                        let c = ' marker-cluster-';
                        if (childCount < 10) {
                            c += 'small';
                        } else if (childCount < 30) {
                            c += 'medium';
                        } else {
                            c += 'large';
                        }
                        
                        if (childCount >= 30) {
                            c += ' cluster-high-density';
                        }

                        return new L.DivIcon({ 
                            html: '<div><span>' + childCount + '</span></div>', 
                            className: 'marker-cluster' + c, 
                            iconSize: new L.Point(40, 40) 
                        });
                    }
                });
                map.addLayer(markerClusterGroup);

                loadEventMarkers();
                initSearchFeature();
                initDragSelection();
                updateRegionList('Korea');

                closeButton.addEventListener('click', () => {
                    detailSheet.classList.remove('active');
                });
            }
        }

        // --- 5. ë§ˆì»¤ ë¡œë“œ ---
        function loadEventMarkers(filterCountry = null, filterRegion = null, filterTag = null) {
            markerClusterGroup.clearLayers();
            allMarkers = [];

            let filteredEvents = mockEvents;
            if (filterCountry) filteredEvents = filteredEvents.filter(e => e.country === filterCountry);
            if (filterRegion) filteredEvents = filteredEvents.filter(e => e.region === filterRegion);
            if (filterTag && filterTag !== 'ì „ì²´') filteredEvents = filteredEvents.filter(e => e.tags.includes(filterTag));

            filteredEvents.forEach(event => {
                const iconHtml = `<div class="event-marker" style="border-color: ${event.color};"><img src="${event.imageUrl}" alt="${event.name}"></div>`;
                const customIcon = L.divIcon({
                    html: iconHtml,
                    className: '',
                    iconSize: [57.6, 57.6],
                    iconAnchor: [28.8, 28.8]
                });

                const marker = L.marker([event.lat, event.lng], { icon: customIcon });
                marker.eventData = event;

                marker.on('click', () => {
                    showDetailSheet(event);
                    map.panTo([event.lat, event.lng]);
                });

                allMarkers.push(marker);
                markerClusterGroup.addLayer(marker);
            });
        }

        // --- 6. ìƒì„¸ ì‹œíŠ¸ í‘œì‹œ ---
        function showDetailSheet(event) {
            const sheet = document.getElementById('detail-sheet');
            document.getElementById('sheet-title').textContent = event.name;
            document.getElementById('sheet-summary').textContent = event.summary;
            document.getElementById('sheet-celeb').textContent = event.celeb;
            document.getElementById('sheet-image').src = event.imageUrl;

            const tagsContainer = document.getElementById('sheet-tags');
            tagsContainer.innerHTML = '';
            event.tags.forEach(tag => {
                const tagEl = document.createElement('span');
                tagEl.className = 'px-2 py-0.5 rounded-full text-xs bg-primary-500/20 text-primary-500 font-bold';
                tagEl.textContent = tag;
                tagsContainer.appendChild(tagEl);
            });

            sheet.classList.add('active');
        }

        // --- 7. êµ­ê°€/ì§€ì—­ í•„í„° ---
        function setCountry(country) {
            currentCountry = country;
            document.getElementById('btn-korea').className = country === 'Korea' 
                ? 'px-4 py-1.5 rounded-full text-sm font-bold bg-primary-500 text-white transition shadow-lg'
                : 'px-4 py-1.5 rounded-full text-sm font-bold bg-gray-700 text-gray-300 hover:bg-gray-600 transition';
            document.getElementById('btn-japan').className = country === 'Japan' 
                ? 'px-4 py-1.5 rounded-full text-sm font-bold bg-primary-500 text-white transition shadow-lg'
                : 'px-4 py-1.5 rounded-full text-sm font-bold bg-gray-700 text-gray-300 hover:bg-gray-600 transition';
            
            updateRegionList(country);
            loadEventMarkers(country);

            const centerCoords = country === 'Korea' ? [35.9, 127.5] : [36.2, 138.25];
            const zoomLevel = country === 'Korea' ? 7 : 5;
            map.setView(centerCoords, zoomLevel);
        }

        function updateRegionList(country) {
            const regionList = document.getElementById('region-list');
            regionList.innerHTML = '';

            const regions = country === 'Korea' 
                ? ["ì„œìš¸", "ê²½ê¸°", "ê°•ì›", "ì¶©ë‚¨", "ì¶©ë¶", "ì „ë¶", "ì „ë‚¨", "ê²½ë¶", "ê²½ë‚¨", "ë¶€ì‚°", "ì œì£¼"]
                : ["ë„ì¿„", "ì˜¤ì‚¬ì¹´", "êµí† ", "í›„ì¿ ì˜¤ì¹´", "í™‹ì¹´ì´ë„", "ì˜¤í‚¤ë‚˜ì™€"];

            regions.forEach(region => {
                const btn = document.createElement('button');
                btn.textContent = region;
                btn.className = 'px-3 py-1 rounded-lg bg-gray-700 text-xs hover:bg-gray-600 transition text-white';
                btn.onclick = () => {
                    filterByRegion(region);
                    highlightRegionBoundary(region);
                };
                regionList.appendChild(btn);
            });
        }

        function filterByRegion(region) {
            loadEventMarkers(currentCountry, region);
        }

        function filterByTag(tag) {
            loadEventMarkers(currentCountry, null, tag);
        }

        // --- 8. ì§€ì—­ ê²½ê³„ ë°œê´‘ (íŒŒë¼ë¯¸í„° ê¸°ë°˜, í¬ê¸° ë™ê¸°í™”) ---
        function highlightRegionBoundary(region) {
            if (currentRegionGlow) {
                map.removeLayer(currentRegionGlow);
                currentRegionGlow = null;
            }

            const params = regionBoundaryParams[region];
            if (!params) return;

            const bounds = L.latLngBounds(params.bounds);
            const rectangle = L.rectangle(bounds, {
                color: params.glowColor,
                weight: params.strokeWidth,
                fillColor: params.glowColor,
                fillOpacity: params.opacity,
                className: 'region-glow-boundary'
            });

            rectangle.addTo(map);
            currentRegionGlow = rectangle;

            map.fitBounds(bounds, { padding: [50, 50], maxZoom: 10 });

            setTimeout(() => {
                if (currentRegionGlow) {
                    map.removeLayer(currentRegionGlow);
                    currentRegionGlow = null;
                }
            }, 5000);
        }

        // --- 9. ê²€ìƒ‰ ê¸°ëŠ¥ (ìµœê·¼ ê²€ìƒ‰ 5ê°œ) ---
        function initSearchFeature() {
            const searchInput = document.getElementById('search-input');
            const historyDiv = document.getElementById('search-history');
            const historyList = document.getElementById('history-list');

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query.length > 0) {
                    const results = mockEvents.filter(ev => 
                        ev.name.toLowerCase().includes(query) ||
                        ev.region.toLowerCase().includes(query) ||
                        ev.tags.some(t => t.toLowerCase().includes(query))
                    );
                    loadEventMarkers(currentCountry);
                    if (results.length > 0) {
                        map.panTo([results[0].lat, results[0].lng]);
                    }
                } else {
                    loadEventMarkers(currentCountry);
                }
            });

            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        addSearchHistory(query);
                        renderSearchHistory();
                    }
                }
            });

            searchInput.addEventListener('focus', () => {
                if (searchHistory.length > 0) {
                    historyDiv.classList.remove('hidden');
                }
            });

            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !historyDiv.contains(e.target)) {
                    historyDiv.classList.add('hidden');
                }
            });

            renderSearchHistory();
        }

        function addSearchHistory(query) {
            searchHistory = searchHistory.filter(q => q !== query);
            searchHistory.unshift(query);
            if (searchHistory.length > 5) searchHistory.pop();
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        }

        function renderSearchHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            searchHistory.forEach(query => {
                const li = document.createElement('li');
                li.className = 'px-4 py-2 hover:bg-gray-700 cursor-pointer text-white';
                li.textContent = query;
                li.onclick = () => {
                    document.getElementById('search-input').value = query;
                    document.getElementById('search-history').classList.add('hidden');
                    document.getElementById('search-input').dispatchEvent(new Event('input'));
                };
                historyList.appendChild(li);
            });
        }

        // --- 10. Alt+ë“œë˜ê·¸ ì„ íƒ (ë§ˆì»¤ ì„ íƒ ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€) ---
        function initDragSelection() {
            let isAltPressed = false;
            let isSelecting = false;
            let startX, startY;
            const selectionBox = document.getElementById('selection-box');

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Alt') {
                    isAltPressed = true;
                    map.dragging.disable();
                }
            });

            document.addEventListener('keyup', (e) => {
                if (e.key === 'Alt') {
                    isAltPressed = false;
                    map.dragging.enable();
                    
                    // Altë§Œ ëˆ„ë¥´ë©´ ì„ íƒ í•´ì œ
                    clearSelection();
                }
            });

            map.getContainer().addEventListener('mousedown', (e) => {
                if (isAltPressed && e.button === 0) {
                    isSelecting = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    selectionBox.style.left = startX + 'px';
                    selectionBox.style.top = startY + 'px';
                    selectionBox.style.width = '0px';
                    selectionBox.style.height = '0px';
                    selectionBox.classList.remove('hidden');
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (isSelecting) {
                    const currentX = e.clientX;
                    const currentY = e.clientY;
                    const width = Math.abs(currentX - startX);
                    const height = Math.abs(currentY - startY);
                    selectionBox.style.width = width + 'px';
                    selectionBox.style.height = height + 'px';
                    selectionBox.style.left = Math.min(startX, currentX) + 'px';
                    selectionBox.style.top = Math.min(startY, currentY) + 'px';
                }
            });

            document.addEventListener('mouseup', (e) => {
                if (isSelecting) {
                    isSelecting = false;
                    const endX = e.clientX;
                    const endY = e.clientY;
                    selectMarkersInBox(startX, startY, endX, endY);
                    selectionBox.classList.add('hidden');
                }
            });
        }

        function selectMarkersInBox(x1, y1, x2, y2) {
            const minX = Math.min(x1, x2);
            const maxX = Math.max(x1, x2);
            const minY = Math.min(y1, y2);
            const maxY = Math.max(y1, y2);

            selectedMarkers = [];

            allMarkers.forEach(marker => {
                const pos = map.latLngToContainerPoint(marker.getLatLng());
                if (pos.x >= minX && pos.x <= maxX && pos.y >= minY && pos.y <= maxY) {
                    selectedMarkers.push(marker);
                    const iconElement = marker.getElement();
                    if (iconElement) {
                        const markerDiv = iconElement.querySelector('.event-marker');
                        if (markerDiv) markerDiv.classList.add('selected-marker');
                    }
                }
            });

            console.log(`ì„ íƒëœ ë§ˆì»¤ ìˆ˜: ${selectedMarkers.length}`);
            
            // ì„ íƒëœ ë§ˆì»¤ë“¤ì— ëŒ€í•œ ì¶”ê°€ ì¸í„°í˜ì´ìŠ¤ (íƒœê·¸ ì¶”ê°€ ë“±)
            if (selectedMarkers.length > 0) {
                showMultiSelectOptions();
            }
        }

        function clearSelection() {
            selectedMarkers.forEach(marker => {
                const iconElement = marker.getElement();
                if (iconElement) {
                    const markerDiv = iconElement.querySelector('.event-marker');
                    if (markerDiv) markerDiv.classList.remove('selected-marker');
                }
            });
            selectedMarkers = [];
            console.log('ì„ íƒ í•´ì œë¨');
        }

        // ì„ íƒëœ ë§ˆì»¤ë“¤ì— ëŒ€í•œ ì¶”ê°€ ì‘ì—… ì¸í„°í˜ì´ìŠ¤ (ì˜ˆ: íƒœê·¸ ì¼ê´„ ì¶”ê°€)
        function showMultiSelectOptions() {
            // TODO: ì„ íƒëœ ë§ˆì»¤ë“¤ì— íƒœê·¸ ì¶”ê°€, ì‚­ì œ, ë©”ëª¨ ì¶”ê°€ ë“±ì˜ UI í‘œì‹œ
            console.log('ë‹¤ì¤‘ ì„ íƒ ì˜µì…˜ í™œì„±í™”:', selectedMarkers.map(m => m.eventData.name));
        }

        // --- 11. í˜ì´ì§€ ë¡œë“œ ---
        window.onload = initializeMap;
    </script>
</body>
</html>
